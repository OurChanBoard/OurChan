meta(charset='utf-8')
meta(name='viewport' content='width=device-width initial-scale=1 viewport-fit=cover')
meta(name='theme-color' content='#282A2E' media='(prefers-color-scheme: dark)')
meta(name='theme-color' content='#DDDDDD' media='(prefers-color-scheme: light)')

// Add no-js class to html element by default
script.
	// Add no-js class immediately to prevent flash of unstyled content
	document.documentElement.classList.add('no-js');

style.
	/* Theme selector styles */
	.no-js-theme-selector {
		background: var(--post-color);
		border: 1px solid var(--post-outline-color);
		padding: 1em;
		margin: 1em;
		border-radius: 3px;
		display: none;
	}

	/* Show the theme selector when targeted in no-JS mode */
	html.no-js #theme-settings:target {
		display: block !important;
		position: fixed;
		top: 3em;
		left: 50%;
		transform: translateX(-50%);
		z-index: 5;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
	}

	.no-js-theme-selector .theme-form {
		display: flex;
		flex-direction: column;
		gap: 1em;
	}

	.no-js-theme-selector .theme-select-group {
		display: flex;
		flex-direction: column;
		gap: 0.5em;
	}

	.no-js-theme-selector select {
		padding: 0.5em;
		border: 1px solid var(--post-outline-color);
		border-radius: 3px;
		background: var(--background-rest);
		color: var(--font-color);
		width: 100%;
	}

	.no-js-theme-selector button {
		padding: 0.5em 1em;
		border: 1px solid var(--post-outline-color);
		border-radius: 3px;
		background: var(--background-rest);
		color: var(--font-color);
		cursor: pointer;
		transition: background 0.2s;
	}

	.no-js-theme-selector button:hover {
		background: var(--darken);
	}

	/* Modal background for no-JS settings */
	html.no-js #theme-settings:target ~ .theme-modal-bg {
		display: block;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.5);
		z-index: 4;
	}

	.theme-modal-bg {
		display: none;
	}

	/* Hide JavaScript-only elements when JavaScript is disabled */
	html.no-js .jsonly {
		display: none !important;
	}

//- very basic styles to hide some elements and improve experience for users with noscript
noscript
	style.
		.jsonly { display: none!important; }
		.user-id { cursor: auto!important; }

//- whether this page is rendered for a board
- const isBoard = board != null;

//- general meta and opengraph meta tags
if isBoard
	if board.settings.description
		meta(name='description' content=board.settings.description)
	if board.settings.tags
		meta(name='keywords' content=board.settings.tags.join(','))
meta(property='og:site_name', value=meta.siteName)
meta(property='og:url', content=meta.url)

//- main stylesheet
link(rel='stylesheet' href=`/css/style.css?v=${commit}&ct=${captchaOptions.type}`)

//- theme stylesheets
- const theme = isBoard ? board.settings.theme : currentTheme;
link#theme(rel='stylesheet' data-theme=theme href=`/css/themes/${theme}.css?v=${commit}`)
- const codeTheme = isBoard ? board.settings.codeTheme : currentCodeTheme;
link#codetheme(rel='stylesheet' data-theme=codeTheme href=`/css/codethemes/${codeTheme}.css?v=${commit}`)
if isBoard && board.settings.customCss
	style#board-customcss #{board.settings.customCss}

//- include html_code from gulp-favicon
include ../../gulp/res/icons/html_code.html

//- language pack
- const pageLanguage = isBoard ? board.settings.language : (locale || globalLanguage);
script(src=`/js/lang/${pageLanguage}.js?v=${commit}`)

//- main script
script(src=`/js/all.js?v=${commit}&ct=${captchaOptions.type}`)

//- optional web3 script
if enableWeb3 || isBoard && board.settings.enableWeb3
	script(src=`/js/web3.js?v=${commit}`)

//- additional scripts included only if hcaptcha, recaptcha, or yandex smartcaptcha are used
if captchaOptions.type === 'google'
	script(src='https://www.google.com/recaptcha/api.js' async defer)
if captchaOptions.type === 'hcaptcha'
	script(src='https://hcaptcha.com/1/api.js' async defer)
if captchaOptions.type === 'yandex'
	script(src='https://smartcaptcha.yandexcloud.net/captcha.js' async defer)

// Complete settings modal for no-JS version - only visible when targeted with #theme-settings
noscript
	div#theme-settings
		.row
			p.bold Settings
			a.close.postform-style(href="#") Ã—
		
		// Main settings sections, organized like the JS modal
		.row
			.form-wrapper.flexleft.mt-10
				// First column - checkboxes
				.row.wrap.sb
					.col.mr-5
						form.form-section(action="/forms/settheme" method="GET")
							input(type="hidden" name="redirectTo" value=meta.url)
							
							// Theme settings in the first column
							h4.settings-header Theme Settings
							.row
								.label Theme
								.settings-value
									select(name="theme" id="no-js-theme")
										option(value="default" selected=currentTheme === 'default') Default
										each theme in themes || []
											option(value=theme selected=theme === currentTheme) #{theme}
							.row
								.label Code Theme
								.settings-value
									select(name="codetheme" id="no-js-codetheme")
										option(value="default" selected=currentCodeTheme === 'default') Default
										each theme in codeThemes || []
											option(value=theme selected=theme === currentCodeTheme) #{theme}
							.row
								button.submit-btn(type="submit") Apply Theme Settings
					
					// Second column - other settings
					.col
						form.form-section(action="/forms/changeaccount" method="POST")
							input(type="hidden" name="_csrf" value=csrf)
							input(type="hidden" name="redirectTo" value=meta.url)
							
							h4.settings-header User Settings
							.row
								.label Default Name
								input#name-setting(type='text' name='name' value=defaultName || '')
							.row
								.label Post Password
								input#postpassword-setting(type='password' name='postpassword' autocomplete='new-password')
							.row
								button.submit-btn(type="submit") Save User Settings
				
				// Display settings section - information about JS-only features
				.row.mt-5
					.form-wrapper.flexleft.w100
						h4.settings-header Display Settings
						p.settings-note The following settings require JavaScript to be enabled:
						
						.settings-grid
							.settings-group
								.settings-option
									label Live posts
								.settings-option
									label Notifications
								.settings-option
									label Only notify (You)s
								.settings-option
									label Scroll to new posts
								.settings-option
									label Local time
								.settings-option
									label 24h time
								.settings-option
									label Show relative time
							
							.settings-group
								.settings-option
									label Hide thumbnails
								.settings-option
									label Recursive post hide
								.settings-option
									label Loop audio/video
								.settings-option
									label Unlimit media height
								.settings-option
									label Crisp image rendering
								.settings-option
									label Show (You)s
								.settings-option
									label Thread watcher

// Modal background for the settings panel in no-JS mode
noscript
	.theme-modal-bg
