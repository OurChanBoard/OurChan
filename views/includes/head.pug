meta(charset='utf-8')
meta(name='viewport' content='width=device-width initial-scale=1 viewport-fit=cover')
meta(name='theme-color' content='#282A2E' media='(prefers-color-scheme: dark)')
meta(name='theme-color' content='#DDDDDD' media='(prefers-color-scheme: light)')

//- very basic styles to hide some elements and improve experience for users with noscript
noscript
	style .jsonly { display: none!important; } .user-id { cursor: auto!important; }


//- whether this page is rendered for a board
- const isBoard = board != null;

//- general meta and opengraph meta tags
if isBoard
	if board.settings.description
		meta(name='description' content=board.settings.description)
	if board.settings.tags
		meta(name='keywords' content=board.settings.tags.join(','))
meta(property='og:site_name', value=meta.siteName)
meta(property='og:url', content=meta.url)

//- main stylesheet
link(rel='stylesheet' href=`/css/style.css?v=${commit}&ct=${captchaOptions.type}`)

//- theme stylesheets
- const theme = isBoard ? board.settings.theme : defaultTheme;
link#theme(rel='stylesheet' data-theme=theme href=`/css/themes/${theme}.css`)
- const codeTheme = isBoard ? board.settings.codeTheme : defaultCodeTheme;
link#codetheme(rel='stylesheet' data-theme=codeTheme href=`/css/codethemes/${codeTheme}.css`)
if isBoard && board.settings.customCss
	style#board-customcss #{board.settings.customCss}

//- include html_code from gulp-favicon
include ../../gulp/res/icons/html_code.html

//- language pack
- const pageLanguage = isBoard ? board.settings.language : (locale || globalLanguage);
script(src=`/js/lang/${pageLanguage}.js?v=${commit}`)

//- main script
script(src=`/js/all.js?v=${commit}&ct=${captchaOptions.type}`)

//- optional web3 script
if enableWeb3 || isBoard && board.settings.enableWeb3
	script(src=`/js/web3.js?v=${commit}`)

//- additional scripts included only if hcaptcha, recaptcha, or yandex smartcaptcha are used
if captchaOptions.type === 'google'
	script(src='https://www.google.com/recaptcha/api.js' async defer)
if captchaOptions.type === 'hcaptcha'
	script(src='https://hcaptcha.com/1/api.js' async defer)
if captchaOptions.type === 'yandex'
	script(src='https://smartcaptcha.yandexcloud.net/captcha.js' async defer)

//- non-JS theme selector (and related components) for users with javascript disabled
noscript
	.noscript-theme-selector
		form(action="/set-theme" method="GET")
			input(type="hidden" name="redirectTo" value=meta.url)
			.theme-select-group
				label(for="noscript-theme") Theme:
				select(name="theme" id="noscript-theme")
					each themeName in availableThemes
						option(value=themeName selected=themeName === selectedTheme) #{themeName}
			.theme-select-group
				label(for="noscript-codetheme") Code Theme:
				select(name="codetheme" id="noscript-codetheme")
					each codeThemeName in availableCodeThemes
						option(value=codeThemeName selected=codeThemeName === selectedCodeTheme) #{codeThemeName}
			input(type="submit" value="Apply Theme")
		p.noscript-explanation
			| You're viewing this site with JavaScript disabled.
			| You can change themes using the form above.
			| Your theme preference will be saved in a cookie.

//- alternate stylesheet links for query parameter support
each themeName in availableThemes
	if themeName !== selectedTheme
		link(rel='alternate stylesheet' data-theme=themeName href=`/css/themes/${themeName}.css` title=`Theme: ${themeName}`)
each codeThemeName in availableCodeThemes
	if codeThemeName !== selectedCodeTheme
		link(rel='alternate stylesheet' data-theme=codeThemeName href=`/css/codethemes/${codeThemeName}.css` title=`Code Theme: ${codeThemeName}`)

//- hidden form for JS users
#theme-form-container(style="display: none;")
	form#theme-form(action="/set-theme" method="GET")
		input(type="hidden" name="theme" id="theme-form-theme")
		input(type="hidden" name="codetheme" id="theme-form-codetheme")
		input(type="hidden" name="redirectTo" id="theme-form-redirect" value=meta.url)

//- styles for JS-less theme selector
style.
	.noscript-theme-selector {
		padding: 10px;
		background: var(--bg-light);
		border: 1px solid var(--selection);
		border-radius: 6px;
		margin-bottom: 15px;
	}
	.noscript-theme-selector .theme-select-group {
		display: inline-block;
		margin-right: 15px;
	}
	.noscript-theme-selector select {
		margin: 0 10px;
		padding: 5px;
		border-radius: 6px;
		border: 1px solid var(--selection);
	}
	.noscript-theme-selector input[type="submit"] {
		margin-left: 10px;
		padding: 5px 10px;
		border-radius: 6px;
		border: 1px solid var(--selection);
		background: var(--bg-btn-primary);
		color: var(--text-btn-primary);
		cursor: pointer;
	}
	.noscript-theme-selector input[type="submit"]:hover {
		background: var(--bg-btn-primary-hover);
	}
	.noscript-explanation {
		margin-top: 10px;
		font-size: 0.9em;
		color: var(--fg-light);
	}
